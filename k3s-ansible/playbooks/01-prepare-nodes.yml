---
- name: Prepare nodes
  hosts: all
  become: yes
  # ğŸ›‘ [í•µì‹¬] ì ‘ì†ì´ í™•ì •ë˜ê¸° ì „ì— ì•¤ì„œë¸”ì´ ë¯¸ë¦¬ ì •ë³´ë¥¼ ìºë‚´ë ¤ë‹¤ ë»—ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.
  gather_facts: no 

  pre_tasks:
    # ğŸš€ [ìŠ¤ë§ˆíŠ¸ í´ë§] SSH ë¬¸ì´ ì—´ë¦´ ë•Œê¹Œì§€ ì—¬ê¸°ì„œ ëŒ€ê¸°í•©ë‹ˆë‹¤.
    # ê¹ƒ ì•¡ì…˜ ë¡œê·¸ì—ëŠ” ì´ ë‹¨ê³„ê°€ ì„±ê³µí•  ë•Œê¹Œì§€ ë¡œë”© í‘œì‹œê°€ ëœ° ê²ë‹ˆë‹¤.
    - name: Wait for SSH to become available dynamically
      ansible.builtin.wait_for_connection:
        delay: 5
        sleep: 5
        timeout: 300

    # ì ‘ì†ì´ í™•ì¸ëœ "ì§í›„"ì— ì„œë²„ ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
    - name: Gather facts after connection is ready
      ansible.builtin.setup:

  roles:
    - k3s-common
    
- name: Prepare all nodes for K3s
  hosts: k3s_cluster # ì¸ë²¤í† ë¦¬ì—ì„œ ë³€ê²½í•œ ê·¸ë£¹ëª…ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
  become: true
  gather_facts: true
  
  # K3s ì„¤ì¹˜ ì „ í•„ìˆ˜ì ì¸ ê³µí†µ í™˜ê²½ë§Œ ì •ë¦¬í•©ë‹ˆë‹¤.
  roles:
    - k3s-common
